From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Tencryn <41876297+Tencryn@users.noreply.github.com>
Date: Fri, 4 Feb 2022 16:28:40 +0000
Subject: [PATCH] Improve Stuck Villager Check


diff --git a/src/main/java/net/minecraft/world/entity/npc/Villager.java b/src/main/java/net/minecraft/world/entity/npc/Villager.java
index 6f9965664860df503f1b153e146ca4754aa334dd..6c3973cb33f0cfba01943760ceaff4b73987b716 100644
--- a/src/main/java/net/minecraft/world/entity/npc/Villager.java
+++ b/src/main/java/net/minecraft/world/entity/npc/Villager.java
@@ -231,6 +231,8 @@ public class Villager extends AbstractVillager implements ReputationEventHandler
             return false;
         }
         net.minecraft.world.level.block.Block bottom = state.getBlock();
+        // Bamboo start - Improve stuck check
+        /*
         if (bottom instanceof net.minecraft.world.level.block.FenceBlock ||
                 bottom instanceof net.minecraft.world.level.block.FenceGateBlock ||
                 bottom instanceof net.minecraft.world.level.block.WallBlock) {
@@ -240,6 +242,14 @@ public class Villager extends AbstractVillager implements ReputationEventHandler
         net.minecraft.world.level.block.Block top = level.getBlockState(pos.above()).getBlock();
         // only if both blocks have no collision
         return !bottom.hasCollision && !top.hasCollision;
+        */
+        // bottom has collision, can't move
+        if (bottom.hasCollision) return false;
+
+        net.minecraft.world.level.block.Block top = level.getBlockState(pos.above()).getBlock();
+        // only if top block has no collision
+        return !top.hasCollision;
+        // Bamboo end
     }
     // Purpur end
 
